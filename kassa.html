<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Targenia - Kassa</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body { font-family: Arial; background:#1f1f2e; color:#fff; margin:0; padding:20px; }
h1 { text-align:center; }
.product { display:flex; justify-content:space-between; margin:10px 0; background:#2c2c44; padding:10px; border-radius:8px; }
form { background:#2c2c44; padding:15px; border-radius:12px; max-width:400px; margin:auto; display:flex; flex-direction:column; gap:10px; }
input, select, textarea, button { padding:8px; border-radius:6px; border:none; }
button { background:#1dd1a1; color:#000; cursor:pointer; }
</style>
</head>
<body>

<h1>Kundvagn & Betalning</h1>
<div id="cartItems"></div>

<form id="checkoutForm">
  <input type="text" id="firstName" placeholder="Förnamn" required>
  <input type="text" id="lastName" placeholder="Efternamn" required>
  <input type="text" id="minecraftName" placeholder="Minecraft-användarnamn" required>
  <input type="text" id="address" placeholder="Adress" required>
  <input type="text" id="publicAccount" placeholder="Public Account Number" required>
  <input type="text" id="secretKey" placeholder="Secret Key" required>
  <label>Hemleverans (+10%)<select id="homeDelivery"><option value="nej">Nej</option><option value="ja">Ja</option></select></label>
  <label>Expressleverans (+20%)<select id="expressDelivery"><option value="nej">Nej</option><option value="ja">Ja</option></select></label>
  <textarea id="notes" placeholder="Anteckningar (Frivilligt)"></textarea>
  <button type="submit">Betala</button>
</form>

<script>
const SUPABASE_URL = 'https://ahfrpztyepvdiyakgkwt.supabase.co';
const SUPABASE_KEY = 'DIN_SUPABASE_ANVÄNDARKEY_HÄR';
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const products = [
  {name:"Bok", price:5, unit:"D/Bok"}, {name:"Koppel", price:3, unit:"D/Stack"},
  {name:"Namnskylt", price:1, unit:"D/10Stycken"}, {name:"Sköldpaddsägg", price:6, unit:"D/Ägg"},
  {name:"Respawn Anchor", price:25, unit:"D/Styck"}, {name:"Elytra", price:0, unit:"Ej Tillgänglig Att Köpa"}
];

let cart = JSON.parse(localStorage.getItem('cart') || '{}');

function renderCart(){
  const div = document.getElementById('cartItems');
  div.innerHTML="";
  Object.keys(cart).forEach(k=>{
    const p = products.find(x=>x.name===k);
    div.innerHTML += `<div class="product">${k} (${cart[k]} st) - ${p.price} ${p.unit}</div>`;
  });
}
renderCart();

document.getElementById('checkoutForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(Object.keys(cart).length===0){ alert("Kundvagnen är tom!"); return; }

  const order = {
    items: cart,
    first_name: document.getElementById('firstName').value,
    last_name: document.getElementById('lastName').value,
    minecraft_name: document.getElementById('minecraftName').value,
    address: document.getElementById('address').value,
    public_account: document.getElementById('publicAccount').value,
    secret_key: document.getElementById('secretKey').value,
    home_delivery: document.getElementById('homeDelivery').value,
    express_delivery: document.getElementById('expressDelivery').value,
    notes: document.getElementById('notes').value,
    order_number: 'ORD'+Math.floor(Math.random()*1000000)
  };

  const { data, error } = await supabase.from('orders').insert([order]);
  if(error){ alert("Fel: "+error.message); return; }
  alert("Order mottagen! Spara ordernummer: "+order.order_number);
  localStorage.removeItem('cart');
  window.location.href = "index.html";
});
</script>

</body>
</html>
