<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Targenia - Admin</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #1f1f2e;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      background: #2c2c44;
      padding: 20px;
      text-align: center;
      font-size: 2em;
      font-weight: bold;
      letter-spacing: 2px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      border: 1px solid #444;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #2c2c44;
    }
    td {
      background: #33334d;
    }
    button {
      padding: 5px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s;
    }
    .done { background: #1dd1a1; }
    .done:hover { background: #10ac84; }
    .refunded { background: #ff6b6b; }
    .refunded:hover { background: #ff5252; }
  </style>
</head>
<body>

<header>Targenia - Admin / Beställningar</header>

<table id="ordersTable">
  <thead>
    <tr>
      <th>Ordernummer</th>
      <th>Förnamn</th>
      <th>Efternamn</th>
      <th>Minecraft</th>
      <th>Adress</th>
      <th>Public Account</th>
      <th>Secret Key</th>
      <th>Hemleverans</th>
      <th>Expressleverans</th>
      <th>Anteckningar</th>
      <th>Items</th>
      <th>Avklarad</th>
      <th>Återbetald</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  // Supabase init
  const supabaseUrl = 'DIN_SUPABASE_URL';
  const supabaseKey = 'DIN_SUPABASE_ANON_KEY';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  async function fetchOrders() {
    const { data, error } = await supabase.from('orders').select('*').order('id', { ascending: true });
    if (error) {
      alert('Fel vid hämtning av orders: ' + error.message);
      return;
    }
    renderOrders(data);
  }

  function renderOrders(orders) {
    const tbody = document.querySelector('#ordersTable tbody');
    tbody.innerHTML = '';
    orders.forEach(order => {
      const tr = document.createElement('tr');

      const items = Object.entries(order.items).map(([name, qty]) => `${name}: ${qty}`).join('<br>');

      tr.innerHTML = `
        <td>${order.order_number}</td>
        <td>${order.first_name}</td>
        <td>${order.last_name}</td>
        <td>${order.minecraft_name}</td>
        <td>${order.address}</td>
        <td>${order.public_account}</td>
        <td>${order.secret_key}</td>
        <td>${order.home_delivery}</td>
        <td>${order.express_delivery}</td>
        <td>${order.notes || ''}</td>
        <td>${items}</td>
        <td><button class="done" onclick="markDone(${order.id})">${order.done ? '✔' : 'Avklarad'}</button></td>
        <td><button class="refunded" onclick="markRefunded(${order.id})">${order.refunded ? '✔' : 'Återbetald'}</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  async function markDone(id) {
    const { data, error } = await supabase.from('orders').update({ done: true }).eq('id', id);
    if (error) alert('Fel: ' + error.message);
    else fetchOrders();
  }

  async function markRefunded(id) {
    const { data, error } = await supabase.from('orders').update({ refunded: true }).eq('id', id);
    if (error) alert('Fel: ' + error.message);
    else fetchOrders();
  }

  fetchOrders();
</script>

</body>
</html>
